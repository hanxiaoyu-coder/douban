import jieba
import re

def preprocess_text(text):
    """文本预处理和分词"""
    # 停用词列表
    stop_words = set([
        '的', '了', '和', '是', '就', '都', '而', '及', '与', '着',
        '之', '在', '也', '因', '此', '但', '并', '个', '其', '些',
        '然', '有', '所', '以', '于', '上', '下', '过', '能', '对',
        '到', '可', '这', '那', '你', '我', '他', '她', '它', '们',
        '为', '或', '由', '某', '从', '如', '到', '既', '么', '之',
        '什么', '还是', '这个', '那个', '只是', '这样', '那样', '不过',
        '很', '还', '又', '这么', '那么', '只', '得', '着', '说', '看',
        '被', '给', '让', '在', '但是', '因为', '所以', '如果', '虽然',
        '一个', '一部', '没有', '不是', '不能', '不会', '可以', '觉得',
        '电影', '片子', '一部', '一个', '一种', '一样', '一直', '一次',
        '感觉', '不错', '真的', '特别', '比较', '完全', '确实', '一点',
        '有点', '整个', '总是', '一般', '完全', '非常', '太', '挺',
        '片', '剧', '部', '分', '场', '幕', '集', '季', '看完',
        '拍', '导演', '演员', '角色', '故事', '剧情', '观众', '评分',
        '豆瓣', '评论', '影评', '观影', '看过', '想看', '推荐',
        # 新增的停用词
        '这部', '这种', '那种', '不要', '可能', '应该', '一下', '一直',
        '好看', '难看', '无聊', '精彩', '烂片', '神作', '佳作', '力作',
        '之前', '之后', '开始', '结束', '中间', '全程', '全片', '片中',
        '不得不', '不禁', '不由', '不免', '不至于', '不至于', '不至于',
        '电影院', '影院', '银幕', '荧幕', '大荧幕', '大银幕',
        '分钟', '小时', '片长', '时长', '时间',
        '第一', '第二', '第三', '第四', '第五',
        '一星', '二星', '三星', '四星', '五星',
    ])
    
    # 移除标点符号和特殊字符
    text = re.sub(r'[^\w\s]', '', text)
    
    # 分词
    words = jieba.cut(text)
    
    # 过滤停用词和空字符
    words = [w for w in words if w not in stop_words and len(w.strip()) > 1]
    
    return words